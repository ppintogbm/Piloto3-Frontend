kind: Template
apiVersion: v1
metadata:
  name: calculadora-front
  description: "Template to deploy Piloto #3 Frontend"
  tags: ibmcom/ace
labels:
  template: calculadora-front
  templateVersion: "1.0"
  app: ${APP}-front
parameters:
  - description: Application deployment name
    displayName: Application
    required: true
    name: APP
    value: 'calculadora'
  - description: 'The base name assigned to all of the objects defined in this template.'
    displayName: Name
    required: true
    name: NAME
    value: front
  - description: The OpenShift Namespace where the ImageStream resides.
    displayName: Namespace
    name: NAMESPACE
    required: true
    value: piloto3
  - description: The ImageStream name
    displayName: ImageStream
    name: IMAGE
    required: true
    value: front
  - description: Service Account with ibm-anyuid-scc configured
    displayName: Service Account 
    name: SA
    required: true
    value: default
objects:
  - kind: DeploymentConfig
    apiVersion: v1
    metadata:
      name: ${APP}-${NAME}-prod
      labels:
        version: prod
    spec:
      replicas: 1
      selector:
        app: ${APP}-front
      template:
        metadata:
          labels:
            app: ${APP}-front
            version: prod
        spec:
          serviceAccount: ${SA}
          containers:
            - name: springboot
              image: " "
              imagePullPolicy: "Always"
              args:
                - "--com.gbm.url=http://${APP}-api:7800/calculadora/v1/operaciones"
              ports:
                - containerPort: 8080
                  protocol: TCP
                  name: http
              livenessProbe:
                httpGet:
                  path: /
                  port: http
              readinessProbe:
                httpGet:
                  path: /
                  port: http
      triggers:
        - type: ImageChange
          imageChangeParams:
            containerNames:
              - springboot
            automatic: true
            from:
              kind: ImageStreamTag
              name: ${IMAGE}:latest
              namespace: ${NAMESPACE}
        - type: ConfigChange
  - kind: DeploymentConfig
    apiVersion: v1
    metadata:
      name: ${APP}-${NAME}-canary
      labels:
        version: canary
    spec:
      replicas: 1
      selector:
        app: ${APP}-canary
      template:
        metadata:
          labels:
            app: ${APP}-front
            version: prod
        spec:
          serviceAccount: ${SA}
          containers:
            - name: springboot
              image: " "
              imagePullPolicy: "Always"
              args:
                - "--com.gbm.url=http://${APP}-api:7800/calculadora/v1/operaciones"
              ports:
                - containerPort: 8080
                  protocol: TCP
                  name: http
              livenessProbe:
                httpGet:
                  path: /
                  port: http
              readinessProbe:
                httpGet:
                  path: /
                  port: http
      triggers:
        - type: ImageChange
          imageChangeParams:
            containerNames:
              - springboot
            automatic: true
            from:
              kind: ImageStreamTag
              name: ${IMAGE}:canary
              namespace: ${NAMESPACE}
        - type: ConfigChange
  - kind: Service
    apiVersion: v1
    metadata:
      name: ${APP}-${NAME}
    labels:
      app: ${APP}-front
    spec:
      selector:
        app: ${APP}-front
      type: ClusterIP
      ports:
        - port: 8080
          protocol: TCP
          name: http-8080